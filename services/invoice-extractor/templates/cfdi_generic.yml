# Template genérico para CFDI mexicanos
# Funciona con la mayoría de facturas electrónicas mexicanas

issuer: CFDI Genérico
keywords:
  - cfdi
  - comprobante fiscal
  - folio fiscal
  - sat
  - timbrado

fields:
  # Proveedor/Emisor
  issuer:
    parser: regex
    regex: (?:Emisor|Proveedor|Razón Social)[\s:]+([A-ZÁÉÍÓÚÑ][A-Za-zÁÉÍÓÚÑáéíóúñ0-9\s,\.&\-]{5,80})
    group: 1

  # RFC del emisor
  vat_number:
    parser: regex
    regex: RFC[\s:]+([A-ZÑ&]{3,4}\d{6}[A-Z0-9]{3})
    group: 1

  # Número de factura (folio)
  invoice_number:
    parser: regex
    regex: Folio[\s:]+([A-Z0-9\-]{1,20})
    group: 1

  # Monto total
  amount:
    parser: regex
    regex: Total[\s:$]*\$?\s*([\d,]+\.?\d*)
    group: 1
    type: float

  # Subtotal
  amount_untaxed:
    parser: regex
    regex: (?:Subtotal|Sub-Total)[\s:$]*\$?\s*([\d,]+\.?\d*)
    group: 1
    type: float

  # IVA
  vat:
    parser: regex
    regex: (?:IVA|I\.V\.A\.)[\s:$]*\$?\s*([\d,]+\.?\d*)
    group: 1
    type: float

  # Fecha de emisión
  date:
    parser: regex
    regex: (?:Fecha de Emisión|Fecha)[\s:]+(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})
    group: 1

  # Fecha de vencimiento (OBLIGATORIO en CFDI según SAT)
  due_date:
    parser: regex
    regex: (?:Fecha de Vencimiento|Vencimiento|Vence|Fecha Límite|Pagar antes)[\s:]+(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})
    group: 1

  # UUID del timbrado
  uuid:
    parser: regex
    regex: (?:UUID|Folio Fiscal)[\s:]+([A-Fa-f0-9\-]{36})
    group: 1

  # Moneda
  currency:
    parser: regex
    regex: Moneda[\s:]+([A-Z]{3})
    group: 1

options:
  currency: MXN
  date_formats:
    - "%d/%m/%Y"
    - "%d-%m-%Y"
    - "%Y-%m-%d"
  decimal_separator: "."
  remove_whitespace: true
